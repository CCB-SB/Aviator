{% load staticfiles %}

{% url 'main:index' as index %}
{% url 'main:overview' as overview %}
{% url 'main:publications' as publications %}
{% url 'main:author' as author %}
{% url 'main:statistics' as statistics %}
{% url 'main:api' as api %}
{% url 'main:help' as help %}
{% url 'main:curated' as curated %}

<script type="text/javascript" src="https://ccb-web.cs.uni-saarland.de/epica/epica.js"
        data-site_id="26"
        data-site_type="Tool"></script>
<noscript>
  <p><img src="//epica.cs.uni-saarland.de/matomo.php?idsite=37&amp;rec=1" style="border:0;" alt=""/>
  </p>
  <p><img src="//epica.cs.uni-saarland.de/matomo.php?idsite=38>&amp;rec=1" style="border:0;"
          alt=""/></p>
</noscript>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin="anonymous" />
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <a class="navbar-brand" href="{{ index }}">AVIATOR</a>
  <div class="navbar-login-container" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item {% if request.path == index %}active{% endif %}">
        <a class="nav-link" href="{{ index }}"><i class="fas fa-home"></i> Home</a>
      </li>
      <li class="nav-item {% if request.path == publications %}active{% endif %}">
        <a class="nav-link" href="{{ publications }}"><i class="fas fa-table"></i> Publications</a>
      </li>
      <li class="nav-item {% if request.path == curated %}active{% endif %}">
        <a class="nav-link" href="{{ curated }}"><i class="fas fa-tools"></i> Curated</a>
      </li>
      <li class="nav-item {% if request.path == author %}active{% endif %}">
        <a class="nav-link" href="{{ author }}"><i class="fas fa-paper-plane"></i> Contact</a>
      </li>
      <li class="nav-item {% if request.path == statistics %}active{% endif %}">
        <a class="nav-link" href="{{ statistics }}"><i class="fas fa-chart-bar"></i> Statistics</a>
      </li>
      <li class="nav-item {% if request.path == api %}active{% endif %}">
        <a class="nav-link" href="{{ api }}"><i class="fas fa-cloud"></i> API</a>
      </li>
      <li class="nav-item {% if request.path == help %}active{% endif %}">
        <a class="nav-link" href="{{ help }}"><i class="fas fa-info-circle"></i> Help</a>
      </li>
    </ul>
    <form id="nav_search_form" class="form-inline my-2 my-lg-0"
          action="{% url 'main:publications' %}" method="post">
      {% csrf_token %}
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" id="ddBtnN"
                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Title&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        </button>
        <div class="dropdown-menu" aria-labelledby="ddBtn1">
          <a class="dropdown-item"
             onclick="document.getElementById('ddBtnN').innerHTML = this.innerHTML;document.getElementById('search_column').value = 0;return false;">Title&nbsp;&nbsp;&nbsp;&nbsp;</a>
          <a class="dropdown-item"
             onclick="document.getElementById('ddBtnN').innerHTML = this.innerHTML;document.getElementById('search_column').value = 3;return false;">Authors&nbsp;&nbsp;</a>
          <a class="dropdown-item"
             onclick="document.getElementById('ddBtnN').innerHTML = this.innerHTML;document.getElementById('search_column').value = 5;return false;">Journal&nbsp;&nbsp;</a>
          <a class="dropdown-item"
             onclick="document.getElementById('ddBtnN').innerHTML = this.innerHTML;document.getElementById('search_column').value = 6;return false;">PubMed
            ID&nbsp;&nbsp;</a>
          <a class="dropdown-item"
             onclick="document.getElementById('ddBtnN').innerHTML = this.innerHTML;document.getElementById('search_column').value = 7;return false;">Abstract&nbsp;&nbsp;</a>
          <a class="dropdown-item"
             onclick="document.getElementById('ddBtnN').innerHTML = this.innerHTML;document.getElementById('search_column').value = 8;return false;">Original
            URL</a>
          <a class="dropdown-item"
             onclick="document.getElementById('ddBtnN').innerHTML = this.innerHTML;document.getElementById('search_column').value = 9;return false;">Derived
            URL</a>
        </div>
      </div>&nbsp;&nbsp;&nbsp;
      <input id="search_column" name="search_column" class="form-control mr-sm-2" type="hidden"
             placeholder="Search" aria-label="Search" value="0">
      <input id="nav_search" name="search_string" class="form-control mr-sm-2" type="search"
             placeholder="Search" aria-label="Search">
      <button id="nav_search_btn" class="btn btn-outline-light my-2 my-sm-0" type="submit"
              onclick=""><i class="fas fa-search"></i> Search
      </button>
      <div>
        <a href="https://www.ccb.uni-saarland.de/" target="_blank" rel="noopener">
          <img src="{% static 'images/logo_ccb_white_h80.png' %}"
               alt="Chair for Clinical Bioinformatics" hspace="10"
               style="width:83px;height:40px;border:0;">
        </a>
      </div>
      <div>
        <a href="http://www.uni-saarland.de/nc/en/home.html" target="_blank" rel="noopener">
          <img src="{% static 'images/logo_uds_white_h80.png' %}"
               alt="University of Saarland, Germany" hspace="10"
               style="width:100px;height:40px;border:0;">
        </a>
      </div>
      <div>
        <a href="https://www.bihealth.org/de/forschung/arbeitsgruppen/dominik-seelow" target="_blank" rel="noopener">
          <img src="{% static 'images/logo_bihealth.png' %}"
               alt="Berlin Institute of Health" hspace="10"
               style="width:163px;height:40px;border:0;">
        </a>
      </div>
    </form>
  </div>
</nav>

<script>
  $(document).ready(function () {
    function createNavbarSearchData() {
      data = {};
      data[$('#search_column').val()] = $('#nav_search').val();
      data["q"] = $('#search_column').val();
      return data;
    }

    $(function () {
      $("#nav_search").autocomplete({
        source: function (request, response) {
          $.getJSON("{% url 'main:autocomplete' %}", createNavbarSearchData(), response);
        },
        minLength: 1
      });
      if ($("#nav_search").autocomplete().data("ui-autocomplete") != undefined) {
        $("#nav_search").autocomplete().data("ui-autocomplete")._renderItem = function (ul, item) {
          var newText = String(item.value).replace(
                  new RegExp(this.term, "gi"),
                  "<span style='color: white;'><strong>$&</strong></span>");
          return $("<li></li>")
                  .data("item.autocomplete", item)
                  .append("<div>" + newText + "</div>")
                  .appendTo(ul);
        };
      }
    });

    $("#nav_search_btn").click(function () {
      // disable button
      $(this).prop("disabled", true);
      // add spinner to button
      $(this).html(`<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> `);

      // submit after 1 sec
      setTimeout(function () {
        $('#nav_search_form').submit();
      }, 1000)
    })
  })
</script>
